<!-- 
    vim:ft=mako: 
-->

<!--
    Define some common widgets 
-->


<%def name='org_draw_node(node, indent=0, selected=None, disable_depth=-1)'>
    <% import oils.org %>
    <option value='${node.id()}'
    % if selected == node.id():
        selected='selected'
    % endif
    % if oils.org.OrgUtil.get_org_type(node).depth() < disable_depth:
        disabled='disabled'
    % endif
    >
        % for i in range(indent):
            &#160;&#160;
        % endfor
        ${node.name()} (${node.shortname()})
    </option> 
    <% indent += 1 %>
    % for child in node.children():
        ${org_draw_node(child, indent)}
    % endfor
        
</%def>

<%def name='org_select(select_name, tree=None, selected=None, disable_depth=-1)'>
    <!-- 
        Draws a select dropdown of the org tree provided with indentation based on org depth.
        @param select_name The form name for the select object
        @param tree The org tree to draw
        @param selected The ID of the org whose <option> to mark as selected
        @param disable_depth Any orgs in the tree whose depth is less than disable_depth
            will have their <options>'s disabled with disabled='disabled'
    -->
    <%
        if tree is None:
            tree = c.oils.core.org_tree.value
    %>
    <select name='${select_name}'>
        ${org_draw_node(tree, 0, selected, disable_depth)}
    </select>
</%def>

<%def name='paging(start, count, max)'>
    <!--
	Creating paging links to move from page to page in long
	list of results
      -->

    <%
       start = int(start)
       if (start + count > max):
           end = max
       else:
           end = start + count
       # set up the paging info
       paging = _('Entries %(offset)d - %(limit)d of %(max)d') % {
           'offset': start + 1, 'limit': end, 'max': max }
    %>

    % if start > 0:
        <a href='?${c.oils.acq.offset.cgi_name}=${start - count}'>&#171;</a>
    % endif

    ${paging}

    % if end < max:
        <a href='?${c.oils.acq.offset.cgi_name}=${end}'>&#187;</a>
    % endif
</%def>

<%def name='build_selector(name, optionmap, chosen=None)'>
    <select name="${name}">

    %if not selected:
        <option value="" selected="selected">${_("-- Select --")}</option>
    %endif

    %for (id, name) in optionmap:
        <option value="${id}"
            %if id == chosen:
                selected='selected'
            %endif
     >${name}</option>
    %endfor
    </select>
</%def>
