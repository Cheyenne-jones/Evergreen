<%def name='jubgrid(domprefix, grid_jsid)'>
<%doc>
This template creates a split screen Dojo layout. The top frame
of the screen holds a list of of JUBs, or titles. Clicking on a
title in the top frame will load the purchase details for all the
copies on order for that title into the bottom frame.

To create a display for a set of JUBs, create a Dojo store and
model for the set of JUBs, then place the following lines in your
HTML where you want the display to appear:

    <%namespace file='/oils/default/common/jubgrid.html' name='jubgrid'/>
    ${jubgrid.jubgrid('dom_prefix', 'grid_jsid')}

where 'dom_prefix' is a string that will be used as the prefix
for the DOM notes that are created by this template, and
'grid_jsid' is a valid JavaScript identifier that will name the
DOM node to which the list of JUBs will be attached.  For example

    ${jubgrid.jubgrid('oils-acq-picklist', 'pickListGrid')}

will create a Dojo grid with the DOM id of

    'oils-acq-picklist-JUB-grid'

and a jsid of

    pickListGrid

To fill the grid with data, call the javascript function

    populateJUBGrid(grid_jsid, model)

'grid_jsid' is the same javascript id that was used to
instantiate the template, and model is a javascript variable
pointing to the JUB model (and store) that you have created.

</%doc>

<div dojoType="dijit.layout.SplitContainer" style='height:100%'
     orientation="vertical" sizerWidth="5"
     activeSizing="1" layoutAlign="client">

    <script src='${c.oils.core.media_prefix.value}/ui_js/oils/default/common/jubgrid.js'> </script>
    <script type="text/javascript">
    JUBGrid.jubGridLayout = [{
        cells: [[
            {name: "ID", field: 'id'},
            {name: "Title", width: "auto", get:JUBGrid.getJUBTitle},
            {name: "Author", get:JUBGrid.getJUBAuthor},
            {name: "ISBN", get:JUBGrid.getJUBIsbn},
            {name: '${_("Pubdate")}', get:JUBGrid.getJUBPubdate},
            {name: "Price", get:JUBGrid.getJUBPrice},
            {name: "Vendor", get:JUBGrid.getProvider},
            {name: "# of Copies", field: 'item_count'},
            {name: "State", field: 'state'}
        ]]
    }];

    JUBGrid.jubDetailGridLayout = [{
        cells: [[
            {name:"ID", field:"id"},
            {name:"Fund", field:"fund",
             get:JUBGrid.getLIDFundName,
             editor: openils.editors.FundSelectEditor,
            },
            {name:"Branch", field:"owning_lib",
	     get:JUBGrid.getLIDLibName,
	     editor: openils.editors.OrgUnitSelectEditor
	    },
        ]]
    }];

    function createLID(fields) {
	fields['lineitem'] = JUBGrid.jubDetailGrid.lineitemID;
	openils.acq.Lineitems.createLID(fields,
			function (lidId) {
			});
    }
    </script>

    <div id="${domprefix + '-container'}"
	 dojoType="dijit.layout.ContentPane" sizeMin="20" sizeShare="50">
	    <div structure='JUBGrid.jubGridLayout' jsid='${grid_jsid}' 
            dojoType='dojox.Grid' id="${domprefix + '-JUB-grid'}"> </div>
    </div>
    <div dojoType="dijit.layout.ContentPane" sizeMin="20" sizeShare="50">
	<div jsid="lineItemButtonbar" dojoType="dijit.layout.ContentPane"
	     id=${domprefix+"-details-buttonbar"}>
	    <div dojoType="dijit.form.DropDownButton">
		<span>${_('New Copy')}</span>
		<div dojoType="dijit.TooltipDialog"
		     execute="createLID(arguments[0]);">
		    <script type='dojo/connect' event='onOpen'>
			globalUser.buildPermOrgSelector('MANAGE_FUND', copyOwnerSelect);
			globalUser.buildPermFundSelector('MANAGE_FUND', acqlidFund);
		    </script>
		    <table class="dijitTooltipTable">
			<tr>
			    <td><label for="fund">${_('Fund:')} </label></td>
			    <td>
				<input dojoType="openils.widget.FundSelector"
				       jsId="acqlidFund"
				       searchAttr="name" autocomplete="true"
				       name="fund"></input>
				</td>
			    </tr>
			<tr>
			    <td><label for="owning_lib">${_('Location:')} </label></td>
			    <td><input dojoType="openils.widget.OrgUnitFilteringSelect"
				       jsId="copyOwnerSelect"
				       searchAttr="shortname"
				       name="owning_lib" autocomplete="true"
				       labelAttr="shortname"></input>
				</td>
			    </tr>
			<tr>
			    <td colspan="2" align="center">
				<button dojotype="dijit.form.Button" type="submit">
				    ${_('Create')}
				</button>
			    </td>
			</tr>
		    </table>
		</div>
	    </div>
	    <button dojotype='dijit.form.Button' onclick='JUBGrid.deleteLID'>
		${_('Delete Selected Copy')}
	    </button>
	</div>
        <div structure='JUBGrid.jubDetailGridLayout' jsid="JUBGrid.jubDetailGrid" dojoType="dojox.Grid"
            id='${domprefix + "-details-grid"}'>
        </div>
    </div>
</div>
</%def>
<!-- Local Variables: -->
<!-- mmm-classes: html-js -->
<!-- End: -->
