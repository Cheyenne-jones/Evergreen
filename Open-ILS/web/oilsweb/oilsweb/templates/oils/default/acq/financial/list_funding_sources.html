# -*- coding: utf-8 -*-
<%inherit file='../base.html'/>
<%namespace file='../../common/widgets.html' name='widget'/>
<%def name="page_title()">${_('Funding Sources')}</%def>
<%def name="block_content()">

<div id='oils-acq-list-header' class='container'>
    <div id='oils-acq-list-header-label'>${_('Funding Sources')}</div>
    <!--
    <div id='oils-acq-list-header-actions'>
        <a href='${c.oils.acq.prefix.value}/funding_source/create'>${_('New Funding Source')}</a>
    </div>
    -->
</div>

<script>var fsGrid = null;</script>


<script type="text/javascript">
    dojo.require("dijit.Dialog");
    dojo.require("dijit.form.FilteringSelect");
    
    /** Creates a new funding source */
    function createFS(fields) {
        openils.acq.FundingSource.create(
            fields, 
            function(fsId) {
                /** The grid won't update after it's been drawn, 
                    at least not in FF, so refresh the page... */
                location.href = location.href;
            }
        );
    }
</script>

<div dojoType="dijit.form.DropDownButton">
    <span>${('New Funding Source')}</span>
    <div dojoType="dijit.TooltipDialog" execute="createFS(arguments[0]);">
        <table class='dijitTooltipTable'>
            <tr>
                <td><label for="name">${_('Name:')} </label></td>
                <td><input dojoType="dijit.form.TextBox" name="name"></td>
            </tr>
            <tr>
                <td><label for="loc">${_('Owning Location:')} </label></td>
                <td>
                    <select name="owner" dojoType="dijit.form.FilteringSelect" autocomplete="false" >
                        <!-- XXX get orgs from DB... -->
                        <option value='2'>SYS1</option>
                        <option value='3'>SYS2</option>
                        <option value='7'>BR4</option>
                    </select>
                </td>
            </tr>
            <tr>
                <td><label for="currency_type">${_('Currency Type:')}</label></td>
                <td>
                    <select name="currency_type" dojoType="dijit.form.FilteringSelect" autocomplete="false" >
                        <!-- XXX get-currency-types from DB... -->
                        <option value='CAN'>CAN</option>
                        <option value='EUR'>EUR</option>
                        <option value='USD'>USD</option>
                    </select>
                </td>
            </tr>
            <tr>
                <td colspan='2' align='center'>
                    <button dojoType=dijit.form.Button type="submit">${_('Create')}</button>
                </td>
            </tr>
        </table>
    </div>
</div> 

<div id='oils-acq-funding-source-grid'> </div>

<script>
    function loadFSGrid() {
        dojo.require('openils.acq.FundingSource');
        var fundingSourceGrid = null;
    
        var gridCols = [
            {name: '${_("ID")}', field: 'id'},
            {name: '${_("Name")}', field: "name", width:'auto'}, 
            {name: '${_("Owner")}', field: "owner", width:'auto'}, 
            {name: '${_("Currency Type")}', field: "currency_type"},
            {name: '${_("Balance")}', field: "balance"}
        ];

        function getSubRowDetail(inRowIndex) {
            if (fundingSourceGrid.expandedRows[inRowIndex]) {
                fsId = fundingSourceGrid.model.getDatum(inRowIndex, 0);
                fs = openils.acq.FundingSource.cache[fsId];
                return '<b>Viewing grid row for FS: ' + fs.name() + '</b>';
            } else
                return '';
        }
    
        var gridRefs = util.Dojo.buildExpandoGrid('oils-acq-funding-source-grid', gridCols, getSubRowDetail);
        fundingSourceGrid = gridRefs.grid;
        openils.acq.FundingSource.loadGrid(fundingSourceGrid, gridRefs.model);
    }

    dojo.addOnLoad(loadFSGrid);
</script>

</%def>
